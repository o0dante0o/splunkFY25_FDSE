version: "3.9"
services:
  react-icons-storybook:
    build: 
      context: .
      dockerfile: ../../infra/visual-tests/Dockerfile.storybook
      args:
        port: 6009
        storybookfolder: storybook-static-visual
        workdir: /react-icons
    command: npx http-server storybook-static-visual --port 6009
    ports:
      - "6009:6009"
  react-icons-visual-test:
    build: 
      context: .
      dockerfile: ../../infra/visual-tests/Dockerfile.visual
      args:
        workdir: /react-icons

    env_file:
      - ./.storybook-visual/config/.env.visual
    working_dir: /react-icons
    volumes:
      - "./src:/react-icons/src"
      - "./test-reports:/react-icons/test-reports"
    depends_on:
      - react-icons-storybook
    command: /bin/sh -c "npx wait-on http://react-icons-storybook:6009 && yarn cache clean && yarn test-storybook -c .storybook-visual --browsers $${STORYBOOK_BROWSER} $${STORYBOOK_UPDATE_SNAPSHOT} $${STORYBOOK_MAX_WORKERS} --url http://react-icons-storybook:6009 --no-index-json"
