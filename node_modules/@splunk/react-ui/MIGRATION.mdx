import Link from '@splunk/react-ui/Link';
import Table from '@splunk/react-ui/Table';

# Migration

This document lists migration guidance for new features and breaking changes.

## 4.33.0

### Deprecated `Button`'s `appearance` values of `"flat"`, `"pill"`, and `"toggle"`

#### Change

`Button`'s `appearance` prop's `"flat"`, `"pill"`, and `"toggle"` values are deprecated and will be removed in the next major version.

#### Context

The `"pill"` value for `appearance` was only supported in Enterprise themes, and the `"flat"` and `"toggle"` values were only supported in the Prisma themes.

As part of our effort to unify behaviors and APIs across themes, we are deprecating these appearances.

#### Migration steps

For Enterprise themes:
* the `"pill"` value can be replaced with `"subtle"` with no other changes.

For Prisma themes:
* the `"flat"` appearance can be replaced by `"secondary"` or `"subtle"` depending on the context in which it appears.
* the `"toggle"` appearance can be replaced with `"default"`.

## 4.30.0

### Deprecated `NavigationProvider`'s `prefix` prop

#### Change

`NavigationProvider`'s `prefix` prop has been deprecated and will be removed in the next major version.

#### Context

`NavigationProvider` allows global control over navigation via `Clickable`, `Link`, and any other component that implements the `to` prop.

One of the supported props is `prefix`, which allows links to be prefixed. This is helpful when your application might be nested inside a path; for example, it could be used to set the locale prefix to a URL.

The new `transformUrl` function can be used to replicate the functionality of `prefix` as well as perform other URL transformations. Therefore, `prefix` is being deprecated to avoid supporting multiple ways to modify the URL.

#### Migration steps

Replace `prefix` with the `transformUrl` function:

```jsx
    const prefix = '/my-prefix'

    <NavigationProvider transformUrl={(url, { isInternal, isRootRelative}) => {
        return isInternal && isRootRelative ? `${prefix}${url}` : url;
    }>
        <Link label="My page" to="/my-page" />
    </NavigationProvider>
```

Note: `prefix` only applied to internal, relative URLs, whereas `transformUrl` applies to all URLs.
However, `transformUrl` provides info about whether a URL is internal or relative that can be used to replicate this behavior.

## 4.29.0

### Deprecated `WaitSpinner`'s `children` prop

#### Change

`WaitSpinner`'s `children` prop has been deprecated and will be removed in the next major version.

#### Context

`WaitSpinner` does not support `children` and the prop was not applied in the render of the component. This was properly documented in the TypeScript API as: `children?: never;`. But due to a documentation bug this was not as explicit in the PropTypes documentation.

#### Migration steps

Remove all usage of `WaitSpinner`'s `children` prop. To render a message beside the wait spinner, render a sibling text element and set `screenReaderText` to `null`.

Example with a sibling text element:

```jsx
    <WaitSpinner screenReaderText={null} />
    <p>Loading logs</p>
```

## 4.27.0

### New `SingleOpenPanelGroup` API for `CollapsiblePanel`

#### Change
A new API, `SingleOpenPanelGroup`, has been added to `CollapsiblePanel`. 

#### Context
`Accordion` and `CollapsiblePanel` have similar style and behavior. Their only behavioral difference was that `Accordion` would only allow one panel to be open at a time, whereas `CollapsiblePanel` would allow multiple panels to be open at a time.

Although they looked and behaved similarly, the APIs of `Accordion` and `CollapsiblePanel` were inconsistent. `inset` was supported in `Accordion` but not `CollapsiblePanel`; while actions were supported in `CollapsiblePanel` but not `Accordion`. Lastly, the components had different numbers of event handlers with different signatures. 

These differences could lead to confusion on which component to use. It could also lead to using one component for a certain feature and then adding custom code to duplicate the functionality from the other component. 

Given these behavioral and technical differences, `Accordion` will be deprecated in the next major version and `CollapsiblePanel` will support all the features of `Accordion` through its `SingleOpenPanelGroup` API. You will still be able to use `Accordion` in the next major version, but we recommend following the migration steps below at your earliest convenience.

#### Migration steps
Replace usage of `Accordion` with the `SingleOpenPanelGroup` component exported from `CollapsiblePanel`. See the `SingleOpenPanelGroup` examples in `CollapsiblePanel`'s documentation.

### Deprecated `onRequestClose` and `onRequestOpen` callbacks and added new `onChange` callback for `CollapsiblePanel`

#### Change
`CollapsiblePanel`'s `onRequestClose` and `onRequestOpen` callbacks have been deprecated and will be removed in the next major version. A new callback `onChange` has been added to `CollapsiblePanel`. 

#### Context
An `onChange` callback is more consistent with other components in `@splunk/react-ui`. 

#### Migration steps
Replace `onRequestClose` and `onRequestOpen` callbacks with the new `onChange` callback when using a controlled `CollapsiblePanel`. See the Controlled example in `CollapsiblePanel`'s documentation.

## 4.26.0

### New `returnFocus` prop for `Modal`

#### Change
A new prop, `returnFocus`, has been added to `Modal`. `returnFocus` is optional for backwards compatibility but will be required in the next major version. 

#### Context
Failing to return focus back to the invoking element (or another logical place) is a WCAG violation. Currently, 
developers must remember to manually return focus. The `returnFocus` prop will be required in the next major version
and ensure focus is returned back to the invoking element. 

#### Migration steps
Previously it was required to add code to manually return focus in `onRequestClose` for the `Modal` and `Modal.Header`. 
This code can now be removed and replaced by passing the invoking element's ref to the new `returnFocus` prop on `Modal`. 

For example, this code snippet:
```jsx
    const handleRequestClose = () => {
        setOpen(false);
        modalToggle?.current?.focus();
    };

    return (
        <>
            <Button onClick={handleRequestOpen} ref={modalToggle} label="Open modal" />
            <Modal onRequestClose={handleRequestClose} open={open}>
                <Modal.Body>Just a basic Modal.</Modal.Body>
            </Modal>
        </>
    );
```
can be converted to this code:
```jsx
    const handleRequestClose = () => {
        setOpen(false);
    };

    return (
        <>
            <Button onClick={handleRequestOpen} ref={modalToggle} label="Open modal" />
            <Modal returnFocus={modalToggle} onRequestClose={handleRequestClose} open={open}>
                <Modal.Body>Just a basic Modal.</Modal.Body>
            </Modal>
        </>
    );
```

## 4.23.0

### Deprecated `JSONTree`'s `expandChildren="withShiftModifier"` value

#### Change
`JSONTree`'s `expandChildren="withShiftModifier"` value has been deprecated and will be removed in a future major version. A new prop `expandChildrenOnShiftKey` has been added to `JSONTree` to expand all descendant nodes when using `shift + click` or `shift + enter`. 

#### Context
Separating the `shift + click` capability from `expandChildren` allows users to decide if they want to enable `shift + click` to expand all descendant nodes independently of
choosing to initially render the tree expanded.

#### Migration steps
Replace all usage of `JSONTree`'s `expandChildren="withShiftModifier"` value with the `expandChildrenOnShiftKey` prop.

## 4.18.0

### Deprecated `level="s"` and `level="ss"` and added new `variant` prop for `Heading`

#### Change
`Heading`'s `level="s"` and `level="ss"` have been deprecated and will be removed in a future major version. A new prop `variant` has been added to `Heading` to add styles from `Typography`'s title variants. 

#### Context
The values "s" and "ss" aren't as clear as numerical values at describing which `<hX>` HTML tag they correspond to. Instead, use `Heading` `level`(1 - 6) and `variant`(title1 - title6) props to achieve the desired `Heading` style. This separates the concerns of semantics from styling, which allows for better accessibility and design.

#### Migration steps
It is recommended to update `Heading`'s `level="s"` and `level="ss"` to `level=5` or `level=6` respectively and use the `variant` prop for styling. 
To keep the same style as `Heading`'s `level="s"` and `level="ss"` follow the below code:

*Enterprise*

`level="s"` styling:

```jsx
const StyledSHeading = styled(Heading)`
    font-weight: ${variables.fontWeightSemiBold};
    font-size: ${variables.fontSize}
    color: ${pick({
        dark: variables.gray80,
        light: variables.gray45,
    })};
`;

<StyledSHeading level={4} variant="title4"/>
```

`level="ss"` styling:

```jsx
const StyledSSHeading = styled(Heading)`
    color: ${pick({
        dark: variables.gray80,
        light: variables.gray45,
    })};
`;

<StyledSHeading level={5} variant="title5"/>
```

*Prisma*

`level="s"` styling:

```jsx
const StyledSHeading = styled(Heading)`
    font-size: ${variables.fontSize};
    color: ${variables.contentColorDefault};
`;

<StyledSHeading level={4} variant="title4"/> 
```

`level="ss"` styling:

```jsx
No styling is needed. 
<Heading level="ss"> is equivalent to <StyledSHeading level={5} variant="title5"/>
```

## 4.17.1

### `TextArea`'s `canClear` prop has been deprecated

#### Context
The clear button causes styling issues in TextArea that made it undesirable to support. When the scrollbar appears in a TextArea the clear button is positioned outside, which causes excessive negative space between the input border and scrollbar. This feature is supported in `Text` and `Search` but those components do not run into the styling issues because they do not have scrollbars.

Additionally, when entering text into a `TextArea` users can clear the contents using "Select all" via keyboard shortcut or mouse selection. These are natively supported actions and don't require a custom control. It was uncommon to see a clear button in other text areas when doing competitive analysis of other design systems.

#### Migration Step

Remove the `canClear` prop from `TextArea`. If supporting a one-click clear action is critical, there are two possible methods to add this feature: 

1) Use the `endAdornment` prop:

```jsx
const [text, setText] = useState('I am clearable content.');
    const handleChange = (e, { value }) => {
        setText(value);
    };

    const handleClearClick = () => {
        setText('');
    };

    return (
        <TextArea
            onChange={handleChange}
            value={text}
            endAdornment={
                <StyledButton
                    appearance="secondary"
                    aria-label="Clear text"
                    icon={<Cross />}
                    onClick={handleClearClick}
                />
        />
    );
/>
```

2) Render a clear action outside of the TextArea:

```jsx
    const [text, setText] = useState('I am clearable content.');
    const handleChange = (e, { value }) => {
        setText(value);
    };

    const handleClearClick = () => {
        setText('');
    };

    return (
        <>
            <TextArea onChange={handleChange} value={text} />
            <StyledButton
                appearance="secondary"
                label="Clear text"
                icon={<Cross />}
                onClick={handleClearClick}
            />
        </>
    );
```


## 4.17.0

### `Typography` `weight` prop

#### Change
`Typography` no longer supports numerical values for `weight`.

#### Context
Supporting both numerical and keyword values creates confusion on which is correct to use.
Themes has new variables in version 4.17.0 that support all of the weight values in the design system.
This aligns with the existing API for `variant` in this component.

#### Migration steps
Convert any usage of a number to the keyword value using the following table based on <Link to="https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight#common_weight_name_mapping" openInNewContext>MDN</Link>: 

<Table>
    <Table.Head>
        <Table.HeadCell>Number</Table.HeadCell>
        <Table.HeadCell>Keyword</Table.HeadCell>
    </Table.Head>
    <Table.Body>
        <Table.Row key={300}>
            <Table.Cell>{300}</Table.Cell>
            <Table.Cell>light</Table.Cell>
        </Table.Row>
        <Table.Row key={400}>
            <Table.Cell>{400}</Table.Cell>
            <Table.Cell>normal</Table.Cell>
        </Table.Row>
        <Table.Row key={500}>
            <Table.Cell>{500}</Table.Cell>
            <Table.Cell>semiBold</Table.Cell>
        </Table.Row>
        <Table.Row key={600}>
            <Table.Cell>{600}</Table.Cell>
            <Table.Cell>semiBold</Table.Cell>
        </Table.Row>
        <Table.Row key={700}>
            <Table.Cell>{700}</Table.Cell>
            <Table.Cell>bold</Table.Cell>
        </Table.Row>
           <Table.Row key={800}>
            <Table.Cell>{800}</Table.Cell>
            <Table.Cell>extraBold</Table.Cell>
        </Table.Row>
           <Table.Row key={900}>
            <Table.Cell>{900}</Table.Cell>
            <Table.Cell>heavy</Table.Cell>
        </Table.Row>
    </Table.Body>
</Table>

For example, convert `<Typography as="p" weight={700} />` to `<Typography as="p" weight='bold' />`.
 
## 4.13.0

### Deprecated `Button` `appearance="pill"`

#### Change
The `Button`'s "pill" appearance is deprecated and will be removed in a future major version.

#### Context
The “pill” appearance is deprecated due to confusion among designers and engineers between the different uses. To minimize confusion, there will be one primary `Button` rounded style.

#### Migration steps
Replace all usage of `Button` `appearance="pill"` with `appearance="default"` or use the `Link` component instead.

### Deprecated `placeholder` prop in `Text`, `TextArea`, and `Number` 

#### Change
The `placeholder` prop in `Text`, `TextArea`, and `Number` is deprecated and will be removed from future major versions.

#### Context
The `placeholder` prop presents multiple visual and cognitive issues and should not be used.

#### Migration steps
The `placeholder` prop should be replaced with `ControlGroup`'s `label` or `help`. It is recommended to avoid using a placeholder, but if appropriate the `placeholder` HTML attribute is still supported.

## 4.12.0

### Deprecated `Text`'s `multiline`, `rowsMax`, and `rowsMin` props

#### Change
`Text`'s `multiline`, `rowsMax`, and `rowsMin` props have been deprecated. Instead use the new `TextArea` component for multiline text input.

#### Context
`Text` supported two modes -- single or multiline. Each modes had exclusive props: e.g. `maxRows` was only valid with the `multiline` prop.
This could be confusing and lead to unexpected or unsupported API combinations. Additionally, code in `Text` would only operate in one mode at a time. Moreover, `Text` with the `multiline` prop does not allow line breaks to be inserted with the “enter” key in some browsers.

By separating these modes, we have made it simpler and clearer to decide which component and props to use.
`Text` should be used for inline text input. `TextArea` should be used for long-form text input.
This aligns the components with the HTML spec and the Splunk Design System.

#### Migration steps
Replace instances of `Text` that use the `multiline` prop with the new `TextArea` component.

## 4.11.0

### New `separateStackingContexts` prop for `LayerStackGlobalProvider`

#### Change
A new prop, `separateStackingContexts`, has been added to `LayerStackGlobalProvider`. `separateStackingContexts` will default to false for backward compatibility but will later default to true in the next major version.

#### Context
Previously, dropdown menus were stacking on top of and blocking modals and modal-backdrops.

Now with `separateStackingContexts`, 'floating' items such as `Popover` and `Modal` will now be stacked in the order they are opened rather than a fixed order.

#### Migration steps
To keep the previous behavior, set `separateStackingContexts={false}`.

## 4.8.0

### Deprecated `RadioBar.Option`'s `icon` prop

#### Change
`RadioBar.Option`'s `icon` prop is deprecated and will be removed in a future major version. 

#### Context
The `RadioBar.Option` icon should not be used due to misalignment with `Text`.

#### Migration steps
Replace all usage of `RadioBar.Option`'s `icon` prop with `startAdornment` and/or `endAdornment`.

## 4.7.0

### Deprecated `Message` `appearance="banner"`

#### Change
`Message`’s `appearance="banner"` option is deprecated and will be removed in a future major version. 

#### Context
Please use `MessageBar` instead of `Message` with `appearance="banner"`. 

Use `MessageBar` for:
- System-level messages (such as expired accounts, server outages, account status, etc). 
- Information, warning, error, or success notifications

Use `Message` or another component for:
- Feedback of actions taken within the page (such as adding, deleting, or saving an item).

#### Migration steps
Replace all usage of `Message`’s `appearance="banner"` option to `MessageBar`.

### Deprecated `Message.Link`

#### Change
`Message.Link` is deprecated and will be removed in a future major version.

### Context
`MessageBar` now applies the necessary styles to `Link`. 

#### Migration steps
Replace all usage of `Message.Link` with the `Link` component as a child of the `MessageBar` component. See entries above or our docs for more information on `MessageBar`.

## 4.5.0

### Deprecated `useSyntheticPlaceholder` prop in `Text` and `Number`

#### Change
The `useSyntheticPlaceholder` prop in `Text` and `Number` is deprecated and will be removed in a future major version.

#### Context
The `useSyntheticPlaceholder` prop is not needed because we no longer support IE11.

#### Migration steps
Remove the `useSyntheticPlaceholder` prop. 

### Deprecated `Monogram` `size="xlarge"`

#### Change
`Monogram`'s `size="xlarge"` is deprecated and will be removed in a future major version.

#### Context
The `xlarge` option for `Monogram`'s `size` prop is deprecated to align with Figma.

#### Migration steps
Replace all usage of `xlarge` as the value for `Monogram`'s `size` prop with the values: `small`, `medium`, `large`, or a number.

## 4.0.0

### `Accordion` no longer supports `collapseAll` prop

#### Change
`Accordion` no longer supports `collapseAll` prop and all panels are allowed to collapse by default.

#### Context
The user needs to be able to skip over any section with `tab`, which is not possible when the first one is open. This prop is no longer supported due to accessibility issues when set to `false`. 

#### Migration steps
Remove all usage of `Accordion` `collapseAll`.

### `File` now supports `fullscreen` prop instead of `size="large"`.

#### Change
`File`’s `size` prop has been removed. Instead, use the `fullscreen` prop. 

#### Context
If `fullscreen` prop is set, there can only be one `File` component on the page as it will take all files dropped on the page. 

#### Migration steps
Replace all usage of `size="large"` with `fullscreen` prop. Remove all other usage of `File` `size`.

### `Dropdown` only supports HTMLElement toggle `ref`

#### Change
`Dropdown` no longer supports passing a toggle that returns a React component instance as `ref`.

#### Context
Previously, this was causing a warning in React strict mode.

#### Migration steps
Ensure the toggle `ref` is an `HTMLElement`, `Clickable`, `Button`, or `Link`.

### `Popover` no longer supports `pointerEvents` prop

#### Change
`Popover`’s `pointerEvents` prop has been removed.

#### Context
Previously, `Tooltip` closed as soon as a user stopped hovering over the toggle. To allow the `Tooltip` to remain open when hovering/focusing on the toggle or the content area, the `Popover`’s `pointerEvent` prop has been removed. `Tooltip` now has two props: `possibleOpenReasons` and `possibleCloseReasons`, which provide more control over when the `Tooltip` can be opened and closed. 

#### Migration steps
Replace all usage of `Popover`’s `pointerEvents` prop with `possibleOpenReasons` and `possibleCloseReasons`.

## 4.30.0

### Deprecated `Text`'s `appearance` prop

#### Change

`Text`'s `appearance` prop has been deprecated and will be removed in the next major version.

#### Context

`Text`'s `appearance` prop allowed the values "default" and "search". 
With the new `Search` component optimized for user interaction, Text's `appearance` prop has become unnecessary. 

#### Migration steps

Replace all usage of `Text`'s `appearance="search"` value with the `Search` component. Remove all usage of `Text`'s `appearance="default"` value. 
